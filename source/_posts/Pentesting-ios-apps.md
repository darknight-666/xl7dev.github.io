---
title: Pentesting ios apps
date: 2016-07-18 21:46:39
tags: ios
---

### Tools
```
openssh
gdb
top
file
gawk
find
gzip
lsof
Netword Commands
pstree
readline
rsync
sed
syslog
vim
hexdump
strings
otool
plutil
FileDP
dumpdecrypted
class-dump
class-dump-z
Keychain-Dumper
cycript
BurpSuite
sslstrip
Introspy-Analyzer
ios-ssl-kill-switch
iFunbox
reveal
Clutch
iRET
idb
```

### plutil
```
> plutil -convert xml1 com.example.plist
```
### FileDP
```
> chmod 777 FileDP
> ./FileDP -d /var/mobile/Applications/<UUID>/Library/Preferences/
> ./FileDP -f /var/mobile/Applications/<UUID>/Library/Preferences/xxx.plist
```
### [class-dump](https://github.com/nygard/class-dump/releases)

### [class-dump-z](http://networkpx.googlecode.com/files/class-dump-z_0.2a.tar.gz)
```
> class-dump-z -H -I appname -o /path/appname.h
```
### [cycript](http://www.cycript.org/debs/)
### [Keychain-Dumper](https://github.com/ptoomey3/Keychain-Dumper)
```
> keychain-dumper -e > /var/tmp/entitlements.xml
> keychain-dumper -a > /var/tmp/password.txt
```
### [dumpdecrypted](http://git.oschina.net/hongyangyi/dumpdecrypted)
> dumpdecrypted 6/7/8

去掉arm64

> 把/var/mobile/Applications/<UUID>/TargetApp.app/XXXTargetApp 复制到mac上

```
> lipo xxx -remove arm64 -output xxx.remove
```
砸壳
```
> cp dumpdecrypted.dylib /var/mobile/Applications/<UUID>/TargetApp.app/Document

> cd /var/mobile/Applications/<UUID>/Document

```
> 输入命令行，回车砸壳完毕

```
DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib /var/mobile/Applications/XXXXXX/TargetApp.app/XXXTargetApp
```
> 显示

```
[+] detected 32bit ARM binary in memory.
[+] offset to cryptid found: @0x81a78(from 0x81000) = a78
[+] Found encrypted data at address 00004000 of length 6569984 bytes - type 1.
[+] Opening /private/var/mobile/Containers/Bundle/Application/03B61840-2349-4559-B28E-0E2C6541F879/TargetApp.app/TargetApp for reading.
[+] Reading header
[+] Detecting header type[+] Executable is a plain MACH-O image
[+] Opening TargetApp.decrypted for writing.
[+] Copying the not encrypted start of the file
[+] Dumping the decrypted data into the file
[+] Copying the not encrypted remainder of the file
[+] Setting the LC_ENCRYPTION_INFO->cryptid to 0 at offset a78
[+] Closing original file[+] Closing dump file
```

### [BurpSuite](https://portswigger.net)

### [Introspy-Analyzer](https://github.com/iSECPartners/Introspy-Analyzer)
Introspy-IOS have a error from github [download](https://isecpartners.github.io/Introspy-iOS/) install have a error，example：
```
iPhone:~ root# dpkg -i com.isecpartners.introspy-v0.4-iOS_7.deb
(Reading database ... 1695 files and directories currently installed.)
Preparing to replace com.isecpartners.introspy 0.4.0-31 (using com.isecpartners.introspy-v0.4-iOS_7.deb) ...
Unpacking replacement com.isecpartners.introspy ...
dpkg: dependency problems prevent configuration of com.isecpartners.introspy:
 com.isecpartners.introspy depends on preferenceloader; however:
  Package preferenceloader is not installed.
 com.isecpartners.introspy depends on applist; however:
  Package applist is not installed.
dpkg: error processing com.isecpartners.introspy (--install):
 dependency problems - leaving unconfigured
Errors were encountered while processing:
 com.isecpartners.introspy
```
fix the bug
```
Cydia search preferenceloader reinstall
```
Install introspy-analyzer
```
> pip install git+https://github.com/iSECPartners/Introspy-Analyzer.git
> python -m introspy -p ios -o output -f 192.168.1.12
> python -m introspy -p ios -l introspy.db
> python -m introspy -p ios -i urls introspy.db
```

### [ios-ssl-kill-switch](https://github.com/iSECPartners/ios-ssl-kill-switch)
### [iFunbox](http://www.i-funbox.com/)
### [reveal](https://revealapp.com/)
### [Clutch](https://github.com/KJCracks/Clutch/releases)
```
iPhone:~ root# chmod +x Clutch
iPhone:~ root# mv /var/root/Clutch /usr/bin/
iPhone:~ root# Clutch

Usage: Clutch [OPTIONS]
-b --binary-dump <value> Only dump binary files from specified bundleID
-d --dump <value>        Dump specified bundleID into .ipa file
-i --print-installed     Print installed applications
   --clean               Clean /var/tmp/clutch directory
   --version             Display version and exit
-? --help                Display this help and exit
-n --no-color            Print with colors disabled
```
### iRET(ios6.x or ios7.x)
#### [iRET](https://github.com/S3Jensen/iRET)
```
> dpkg -i iRET.deb
```
browser open website http://<ip>:5555
####perl
```
> wget http://coredev.nl/cydia/coredev.pub
> apt-key add coredev.pub
> echo 'deb http://coredev.nl/cydia iphone main' > /etc/apt/sources.list.d/coredev.nl.list
> apt-get update
> apt-get install perl
```
#### dumpdecrypted
```
> git clone https://github.com/stefanesser/dumpdecrypted
> cd dumpdecrypted && make
> scp dumpdecrypted.dylib root@<ip>:/Applications/iRE.app
```
添加源

```
http://coredev.nl/cydia/
http://nix.howett.net/theos/
```
#### theos
```
IOS8.1 SDK 链接: http://pan.baidu.com/s/1kUOKYUz3 密码: cmcr
```
### [idb](https://github.com/dmayer/idb)
```
> brew install qt cmake usbmuxd libimobiledevice
```

### fix Cydia install lsof

> download [lsof-arm7-iOS4.2](https://github.com/sunkehappy/iOS-reverse-engineering-tools-backup/blob/master/lsof-arm7-iOS4.2)

```
iPhone5S:~ root# mv /usr/bin/lsof /usr/bin/lsof-backup
iPhone5S:~ root# wget https://github.com/sunkehappy/iOS-reverse-engineering-tools-backup/blob/master/lsof-arm7-iOS4.2?raw=true -O /usr/bin/lsof
iPhone5S:~ root# chmod +x /usr/bin/lsof
```